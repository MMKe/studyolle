<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments::head"></head>
<body class="bg-light">
<div th:replace="fragments::main-nav"></div>

<div class="container">
  <div class="row mt-5 justify-content-center">
    <div class="col-2">
      <div th:replace="fragments::settings-menu (currentMenu='zones')"></div>
    </div>
    <div class="col-8">
      <div class="row">
        <h2 class="col-12">주요 활동 지역</h2>
      </div>
      <div class="row">
        <div class="col-12">
          <div class="alert alert-info" role="alert">
            <p>주로 스터디를 다닐 수 있는 지역을 등록하세요.</p>
            <p>해당 지역에 스터디가 생기면 알림을 받을 수 있습니다.</p>
            <p>시스템에 등록된 지역만 선택할 수 있습니다.</p>
          </div>
          <div id="whitelist" th:text="${whitelist}" hidden=""></div>
          <input id="zones" type="text" name="zones" class="tagify--outside" aria-describedby="tagHelp"
                 th:value="${#strings.listJoin(zones, ',')}"/>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript" src="/node_modules/@yaireo/tagify/dist/tagify.js"></script>

<script type="text/javascript" th:inline="javascript">
  $(function () {
    const csrfToken = /*[[${_csrf.token}]]*/ null;
    const csrfHeader = /*[[${_csrf.headerName}]]*/ null;
    $(document).ajaxSend(function (e, xhr, options) {
      xhr.setRequestHeader(csrfHeader, csrfToken);
    });
  })
</script>

<script type="text/javascript">
  $(function () {
    function zoneResult(url, zoneName) {
      $.ajax({
        dataType: "json",
        autoComplete: {
          enabled: true,
          rightKey: true,
        },
        contentType: "application/json; charset=utf-8",
        method: "POST",
        url: "/settings/zones" + url,
        data: JSON.stringify({'zoneName': zoneName}),
      }).done(function (data, status) {
        console.log("${data} and status is ${status}")
      });
    }

    function onAdd(e) {
      zoneResult("/add", e.detail.data.value);
    }

    function onRemove(e) {
      zoneResult("/remove", e.detail.data.value);
    }

    const tagInput = document.getElementById("zones");
    const tagify = new Tagify(tagInput, {
      whitelist: JSON.parse(document.getElementById("whitelist").textContent),
      enforceWhitelist: true,
      dropdown: {
        enabled: 1,
      }
    });
    tagify.on("add", onAdd);
    tagify.on("remove", onRemove);
  })
</script>
</body>
</html>
